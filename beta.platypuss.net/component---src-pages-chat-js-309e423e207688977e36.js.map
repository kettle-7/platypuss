{"version":3,"file":"component---src-pages-chat-js-309e423e207688977e36.js","mappings":"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","sources":["webpack://platypuss-beta/./src/components/common.jsx","webpack://platypuss-beta/./src/pages/chat.js"],"sourcesContent":["import React from \"react\";\n\nexport const PageHeader = ({ title }) => {\n    return (<header><h2 onClick={()=>{window.location = \"/\"}} style={{cursor: \"pointer\"}}>{title ? title : \"(Beta!) Platypuss\"}</h2></header>);\n};","/************************************************************************\n* Copyright 2021-2024 Ben Keppel                                        *\n*                                                                       *\n* This program is free software: you can redistribute it and/or modify  *\n* it under the terms of the GNU General Public License as published by  *\n* the Free Software Foundation, either version 3 of the License, or     *\n* (at your option) any later version.                                   *\n*                                                                       *\n* This program is distributed in the hope that it will be useful,       *\n* but WITHOUT ANY WARRANTY; without even the implied warranty of        *\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *\n* GNU General Public License for more details.                          *\n*                                                                       *\n* You should have received a copy of the GNU General Public License     *\n* along with this program.  If not, see <http://www.gnu.org/licenses/>. *\n************************************************************************/\n// °^° i am pingu\n\nimport * as Common from \"../components/common\";\nimport * as React from \"react\";\nimport \"./light.scss\";\n\nvar userCache = {}; // A cache of data on users so we don't constantly have to look it up\nvar messageCache = {}; // The same but for messages, we might not need this\nvar permissions = {}; // The permissions we have, key being an identifier and value being a friendly description\nvar states = {populated:false}; // One global variable for storing React state objects so we can access them anywhere\nvar openSockets = {}; // Keeps track of open websockets\nvar peers = {}; // Keeps track of other people on the server (platonically of course :3)\nvar loadedMessages = 0; // The number of messages loaded in the current view, used when loading older messages\nvar serverHashes = {}; // We can use these to get links to specific servers / maybe rooms in the future\n\nvar pageUrl = window ? new URL(window.location) : new URL(\"http://localhost:8000\"); // window is not defined in the testing environment so just assume localhost\nvar authUrl = \"https://platypuss.net\"; // Authentication server, you shouldn't have to change this but it's a variable just in case\nconst emailRegexp = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/gi;\npageUrl.protocol = \"https\"; // remove this in production\n\n// thanks bryc on stack overflow ^w^\nfunction hashPassword (str, seed = 20) { // hashes things somehow\n    let h1 = 0xdeadbeef ^ seed, // had to be something\n    h2 = 0x41c6ce57 ^ seed;\n    for (let i = 0, ch; i < str.length; i++) {\n        ch = str.charCodeAt(i);\n        // Math.imul multiplies without loss of precision\n        h1 = Math.imul(h1 ^ ch, 2654435761);\n        h2 = Math.imul(h2 ^ ch, 1597334677);\n    }\n    \n    h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);\n    h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);\n\n    return (h2>>>0).toString(16).padStart(8,0)+(h1>>>0).toString(16).padStart(8,0);\n};\n\n// Fetch data on one user, from cache if possible but from the authentication server otherwise\nfunction fetchUser(id) {\n  return new Promise((resolve, reject) => {\n    if (userCache[id] == undefined) {\n      // try fetch data from the authentication server\n      fetch(authUrl+'/uinfo?id='+id).then(response => {\n        // try turn the json response into an object\n        response.json().then(responseObject => {\n          userCache[id] = responseObject;\n          resolve(responseObject);\n        }).catch(()=>reject()); // if it's not valid json then reject the promise\n      }).catch(()=>reject()); // same for if we can't connect to the server for some reason\n    } else {\n      resolve(userCache[id]); // we already know about the user so don't look them up\n    }\n  });\n}\n\n// The bar on the left showing the servers you're in, also for navigation\nfunction ServersBar() {\n  return (<div className=\"sidebar\" id=\"serversBar\">\n    <img className=\"serverIcon\" src=\"\" alt=\"+\" id=\"newServerButton\"/>\n    {Object.values(states.servers).map(server => (<ServerIcon server={server} serverBar={this}></ServerIcon>))}\n  </div>);\n}\n\n// The bar on the right showing other server members\nfunction PeersBar({focusedServer}) {\n  return (<div className=\"sidebar\" id=\"serversBar\">\n    <img className=\"serverIcon material-symbols-outlined\" src=\"\" alt=\"+\" id=\"newServerButton\"/>\n  </div>);\n}\n\n// Renders a single message\nfunction Message({message}) {\n  return (<div className=\"message1\">\n    <img src={userCache[message.author].avatar} alt=\"\"/>\n    <div className=\"message2\">\n      <h3 className=\"messageUsernameDisplay\">{userCache[message.author].username}</h3>\n      <p>{message.content}</p>\n    </div>\n  </div>);\n}\n\n// The midsection between these two aforementioned bars\nfunction MiddleSection() {\n  return (<div id=\"middleSection\">\n    <div id=\"aboveScrolledArea\"></div>\n    <div id=\"scrolledArea\"> {/* Has a scrollbar, contains load more messages button but not message typing box */}\n      <div id=\"aboveMessageArea\"></div>\n      <div id=\"messageArea\">{Object.values(states.focusedRoomRenderedMessages).map(message => <Message/>)}</div>\n      <div id=\"belowMessageArea\"></div>\n    </div>\n    <div id=\"belowScrolledArea\"></div>\n  </div>);\n}\n\n// a server icon button thing\nfunction ServerIcon({server, serverBar}) {\n  [server.manifest, server.setManifest] = React.useState({\n    iconURL: \"\",\n    serverTitle: \"connecting to the server???\"\n  });\n  return (<img className=\"serverIcon\" src={server.manifest.iconURL} alt=\"🐙\"/>);\n}\n\n// The document head contains metadata, most of it is defined in use-site-metadata.jsx\nexport const Head = () => (\n  <title>(Beta!) Platypuss</title>\n);\n\nasync function loadView() {\n  // connect to the authentication server to get the list of server's we're in and their session tokens\n  for (let message of Object.keys(states.focusedRoomRenderedMessages)) {\n    delete states.focusedRoomRenderedMessages[message];\n  }\n  states.setFocusedRoomRenderedMessages({});\n  fetch(`${authUrl}/getServerTokens?id=${localStorage.getItem(\"sessionID\")}`).then(data => data.json()).then(async function(data) {\n    for (let socket of Object.values(openSockets)) {\n      socket.close();\n    }\n    for (let serverName in data.servers) { // this for loop lets us keep the same server focused between reloads\n      serverHashes[serverName] = hashPassword(serverName); // it's not a password but who cares\n      if (states.focusedServer == {manifest:{}}) {\n        if (window.location.toString().replace(/^.*\\#/g, \"\") == serverHashes[serverName]) {\n          states.focusedServer = serverName;\n        }\n      }\n    }\n    let servers = {};\n    for (let serverCode of Object.keys(data.servers)) {\n      let splitServerCode = serverCode.split(' ');\n      let ip = splitServerCode[0];\n      let inviteCode = splitServerCode[1];\n      let subserver = splitServerCode[2];\n      console.log(pageUrl.protocol + \"//\"+ip.toString());\n      servers[serverCode] = {\n        ip: ip,\n        inviteCode: inviteCode,\n        subserver: subserver,\n        manifest: {\n          title: \"Loading\",\n          icon: \"/icon.png\",\n          memberCount: 0,\n          public: false,\n          description: \"Waiting for a response from the server\"\n        }\n      };\n      fetch(pageUrl.protocol + \"//\"+ip.toString()).then(response => response.json).then(serverManifest => {\n        console.log(serverManifest);\n      }).catch(error => {console.log(error)});\n    }\n    states.setServers(servers);\n    if (states.focusedServer == {manifest:{}}) {\n      states.setFocusedServer(states.servers[Object.keys(data.servers)[0]]);\n    }\n  });\n}\n\n// The page itself\nexport default function ChatPage() {\n  // set a bunch of empty React state objects for stuff that needs to be accessed throughout the program\n  [states.servers, states.setServers] = React.useState({}); // Data related to servers the user is in\n  [states.focusedRoomRenderedMessages, states.setFocusedRoomRenderedMessages] = React.useState({}); // The <Message/> elements shown in the view, set in ChatPage\n  [states.focusedServer, states.setFocusedServer] = React.useState({manifest:{}}); // An object representing the currently focused server\n  [states.focusedRoom, states.setFocusedRoom] = React.useState({}); // An object representing the currently focused room\n  [states.focusedServerRenderedRooms, states.setFocusedServerRenderedRooms] = React.useState({}); // The <RoomLink/> elements in the sidebar for this server\n  \n  console.log(states.populated);\n  if (!states.populated) loadView();\n  states.populated = true;\n  // return the basic page layout\n  return (<>\n    <Common.PageHeader title={states.focusedServer.manifest.title}/>\n    <main>\n      <div id=\"chatPage\">\n        <ServersBar/>\n        <MiddleSection/>\n        <PeersBar/>\n      </div>\n    </main>\n  </>);\n}\n"],"names":["PageHeader","title","React","onClick","window","location","style","cursor","userCache","states","populated","openSockets","serverHashes","pageUrl","URL","authUrl","hashPassword","str","seed","h1","h2","ch","i","length","charCodeAt","Math","imul","toString","padStart","ServersBar","className","id","src","alt","Object","values","servers","map","server","ServerIcon","serverBar","this","PeersBar","focusedServer","Message","message","author","avatar","username","content","MiddleSection","focusedRoomRenderedMessages","manifest","setManifest","iconURL","serverTitle","protocol","Head","ChatPage","setServers","setFocusedRoomRenderedMessages","setFocusedServer","focusedRoom","setFocusedRoom","focusedServerRenderedRooms","setFocusedServerRenderedRooms","console","log","async","keys","fetch","localStorage","getItem","then","data","json","socket","close","serverName","replace","serverCode","splitServerCode","split","ip","inviteCode","subserver","icon","memberCount","public","description","response","serverManifest","catch","error","loadView","Common"],"sourceRoot":""}