"use strict";(self.webpackChunkplatypuss_beta=self.webpackChunkplatypuss_beta||[]).push([[646],{472:function(e,t,s){s.d(t,{m:function(){return r}});var n=s(7294);const r=({title:e,iconClickEvent:t})=>n.createElement("header",null,n.createElement("img",{onClick:t||(()=>{window.location="/"}),style:{cursor:"pointer"},src:"/icons/icon-48x48.png"}),n.createElement("h2",{onClick:()=>{window.location="/"},style:{cursor:"pointer"}},e||"(Beta!) Platypuss"))},2496:function(e,t,s){s.r(t),s.d(t,{Head:function(){return E},default:function(){return M}});var n=s(472),r=s(7294),o={},a={populated:!1},l={},i={},c="undefined"!=typeof window,d=c?new URL(window.location):new URL("http://localhost:8000"),m="https://platypuss.net";function u(e,t=20){let s=3735928559^t,n=1103547991^t;for(let r,o=0;o<e.length;o++)r=e.charCodeAt(o),s=Math.imul(s^r,2654435761),n=Math.imul(n^r,1597334677);return s=Math.imul(s^s>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),(n>>>0).toString(16).padStart(8,0)+(s>>>0).toString(16).padStart(8,0)}function v({shown:e}){return r.createElement("div",{className:"sidebar",id:"serversBar",style:{display:e?"flex":"none"}},r.createElement("img",{className:"serverIcon",src:"",alt:"+",id:"newServerButton"}),Object.values(a.servers).map((e=>r.createElement(S,{server:e}))))}function f({shown:e}){return r.createElement("div",{className:"sidebar",id:"serversBar",style:{display:e?"flex":"none"}},r.createElement("img",{className:"serverIcon material-symbols-outlined",src:"",alt:"+",id:"newServerButton"}))}function h({message:e}){let[t,s]=r.useState(o[e.author]||{avatar:"https://img.freepik.com/premium-vector/hand-drawn-cartoon-doodle-skull-funny-cartoon-skull-isolated-white-background_217204-944.jpg",username:"Deleted User"});var n;return(n=e.author,new Promise(((e,t)=>{null==o[n]?fetch(m+"/uinfo?id="+n).then((s=>{s.json().then((t=>{o[n]=t,e(t)})).catch((()=>t()))})).catch((()=>t())):e(o[n])}))).then((e=>{s(e)})),r.createElement("div",{className:"message1"},r.createElement("img",{src:t.avatar,alt:"",className:"avatar"}),r.createElement("div",{className:"message2"},r.createElement("h3",{className:"messageUsernameDisplay"},t.username),r.createElement("p",null,e.content.toString())))}function g({shown:e}){return r.createElement("div",{id:"middleSection",style:{display:e?"flex":"none"}},r.createElement("div",{id:"aboveScrolledArea"}),r.createElement("div",{id:"scrolledArea"}," ",r.createElement("div",{id:"aboveMessageArea"}),r.createElement("div",{id:"messageArea"},Object.values(a.focusedRoomRenderedMessages).map((e=>r.createElement(h,{message:e})))),r.createElement("div",{id:"belowMessageArea"})),r.createElement("div",{style:{height:5,background:"linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3))"}}),r.createElement("div",{id:"belowScrolledArea"},r.createElement("div",{contentEditable:!0,id:"messageBox",onKeyDown:e=>{"Enter"!=e.key||a.useMobileUI||e.shiftKey||(p(),e.preventDefault())}}),r.createElement("button",{className:"material-symbols-outlined"},"publish"),r.createElement("button",{className:"material-symbols-outlined",onClick:p},"send")))}function p(){let e=l[a.focusedServer],t=document.getElementById("messageBox");e.send(JSON.stringify({eventType:"message",message:{content:t.innerText}})),t.innerHTML=""}function S({server:e}){return[e.manifest,e.setManifest]=r.useState({icon:"",title:"Couldn't connect to this server 🐙"}),r.createElement("div",{className:"popoverContainer"},r.createElement("img",{className:"serverIcon",src:e.manifest.icon,alt:"🐙",onClick:()=>{a.setFocusedServer(e.serverCode),y(e.serverCode)}}),r.createElement("div",{className:"serverIconPopover"},e.manifest.title))}function b({room:e}){return r.createElement("div",{className:"roomLink",style:{cursor:"pointer"}},r.createElement("a",null,e.name))}function w({shown:e}){return r.createElement("div",{className:"sidebar",id:"roomsBar",style:{display:e?"flex":"none"}},r.createElement("div",{id:"serverTitle",style:{cursor:"pointer",backgroundImage:a.focusedServer?a.servers[a.focusedServer].manifest.icon:""}},r.createElement("h3",{style:{margin:5}},a.focusedServer?a.servers[a.focusedServer].manifest.title:"Loading servers..."),r.createElement("div",{style:{flexGrow:1}}),r.createElement("span",{className:"material-symbols-outlined"},"stat_minus_1")),Object.values(a.focusedServerRenderedRooms).map((e=>r.createElement(b,{server:e}))),0==Object.values(a.focusedServerRenderedRooms).length?r.createElement("p",null,"This server doesn't have any rooms in it."):r.createElement(r.Fragment,null))}d.protocol="https";const E=()=>r.createElement("title",null,"(Beta!) Platypuss");async function y(e){c&&(a.setFocusedRoomRenderedMessages({}),fetch(`${m}/getServerTokens?id=${localStorage.getItem("sessionID")}`).then((e=>e.json())).then((async function(t){for(let e of Object.values(l))e.close();for(let n in t.servers)i[n]=u(n),window.location.toString().replace(/^.*\#/g,"")!=i[n]||e||a.setFocusedServer(n);let s={};for(let n in t.servers){let r=n.split(" "),o=r[0],i=r[1],c=r[2];s[n]={ip:o,serverCode:n,inviteCode:i,subserver:c,manifest:{title:"Loading",icon:"/icon.png",memberCount:0,public:!1,description:"Waiting for a response from the server"}},fetch(d.protocol+"//"+o+"/"+c).then((e=>e.json())).then((e=>{s[n].setManifest(e)})).catch((e=>{console.log(e)}));let u=new WebSocket(("https:"==d.protocol?"wss:":"ws")+"//"+o);u.onerror=()=>{console.error(`Warning: couldn't connect to ${o}, try check your internet connection or inform the owner(s) of the server.`),a.focusedServer},u.onopen=()=>{l[n]=u,u.send(JSON.stringify({eventType:"login",subserver:c,inviteCode:i,sessionID:t.servers[n]})),a.servers[a.focusedServer]||(a.servers[e]?a.setFocusedServer(e):a.setFocusedServer(n))},u.onclose=()=>{console.error(`Warning, the server at ${o} closed.`),a.focusedServer},u.onmessage=async e=>{let s,r=JSON.parse(e.data);switch(r.eventType){case"message":if("hidden"==document.visibilityState&&t.userId!=r.message.author&&new Audio(m+"/randomsand.wav").play(),a.focusedServer!==n)break;s={...a.focusedRoomRenderedMessages},s[r.message.id]=r.message,a.setFocusedRoomRenderedMessages(s);break;case"messages":if(a.focusedServer!==n)break;s={...a.focusedRoomRenderedMessages};for(let e of r.messages)s[e.id]=e;a.setFocusedRoomRenderedMessages(s);break;case"connecting":break;default:if("explanation"in r&&a.focusedServer===n){s={...a.focusedRoomRenderedMessages};let e=Math.random().toString();s[e]={special:!0,author:null,content:r.explanation.toString(),id:e},a.setFocusedRoomRenderedMessages(s)}console.log(r.explanation)}}}a.setServers(s)})).catch((e=>console.log(e))))}function M(){return[a.servers,a.setServers]=r.useState({}),[a.focusedRoomRenderedMessages,a.setFocusedRoomRenderedMessages]=r.useState({}),[a.focusedServer,a.setFocusedServer]=r.useState(null),[a.focusedRoom,a.setFocusedRoom]=r.useState({}),[a.focusedServerRenderedRooms,a.setFocusedServerRenderedRooms]=r.useState({}),[a.mobileSidebarShown,a.setMobileSidebarShown]=r.useState(!0),[a.useMobileUI,a.setUseMobileUI]=r.useState(!!c&&2.54*window.innerWidth/96<20),c&&window.addEventListener("resize",(()=>{a.setUseMobileUI(!!c&&2.54*window.innerWidth/96<20)})),a.populated||y(),a.populated=!0,r.createElement(r.Fragment,null,r.createElement(n.m,{iconClickEvent:()=>{a.useMobileUI?a.setMobileSidebarShown(!a.mobileSidebarShown):window.location="/"}}),r.createElement("main",null,r.createElement("div",{id:"chatPage"},r.createElement(v,{shown:a.mobileSidebarShown||!a.useMobileUI}),r.createElement(w,{shown:a.mobileSidebarShown||!a.useMobileUI}),r.createElement(g,{shown:!a.mobileSidebarShown||!a.useMobileUI}),r.createElement(f,{shown:a.mobileSidebarShown||!a.useMobileUI}))))}}}]);
//# sourceMappingURL=component---src-pages-chat-js-5dee05de6e1773b57547.js.map