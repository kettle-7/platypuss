"use strict";(self.webpackChunkplatypuss_beta=self.webpackChunkplatypuss_beta||[]).push([[646],{472:function(e,t,s){s.d(t,{m:function(){return n}});var r=s(7294);const n=({title:e,iconClickEvent:t})=>r.createElement("header",null,r.createElement("img",{onClick:t||(()=>{window.location="/"}),style:{cursor:"pointer"},src:"/icons/icon-48x48.png"}),r.createElement("h2",{onClick:()=>{window.location="/"},style:{cursor:"pointer"}},e||"(Beta!) Platypuss"))},2496:function(e,t,s){s.r(t),s.d(t,{Head:function(){return w},default:function(){return y}});var r=s(472),n=s(7294),o={},a={populated:!1},l={},i={},c="undefined"!=typeof window,d=c?new URL(window.location):new URL("http://localhost:8000"),m="https://platypuss.net";function u(e,t=20){let s=3735928559^t,r=1103547991^t;for(let n,o=0;o<e.length;o++)n=e.charCodeAt(o),s=Math.imul(s^n,2654435761),r=Math.imul(r^n,1597334677);return s=Math.imul(s^s>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),(r>>>0).toString(16).padStart(8,0)+(s>>>0).toString(16).padStart(8,0)}function v({shown:e}){return n.createElement("div",{className:"sidebar",id:"serversBar",style:{display:e?"flex":"none"}},n.createElement("img",{className:"serverIcon",src:"",alt:"+",id:"newServerButton"}),Object.values(a.servers).map((e=>n.createElement(p,{server:e}))))}function f({shown:e}){return n.createElement("div",{className:"sidebar",id:"serversBar",style:{display:e?"flex":"none"}},"peers",n.createElement("img",{className:"serverIcon material-symbols-outlined",src:"",alt:"+",id:"newServerButton"}))}function h({message:e}){let[t,s]=n.useState(o[e.author]||{avatar:"https://img.freepik.com/premium-vector/hand-drawn-cartoon-doodle-skull-funny-cartoon-skull-isolated-white-background_217204-944.jpg",username:"Deleted User"});var r;return(r=e.author,new Promise(((e,t)=>{null==o[r]?fetch(m+"/uinfo?id="+r).then((s=>{s.json().then((t=>{o[r]=t,e(t)})).catch((()=>t()))})).catch((()=>t())):e(o[r])}))).then((e=>{s(e)})),n.createElement("div",{className:"message1"},n.createElement("img",{src:t.avatar,alt:"",className:"avatar"}),n.createElement("div",{className:"message2"},n.createElement("h3",{className:"messageUsernameDisplay"},t.username),n.createElement("p",null,e.content.toString())))}function g({shown:e}){return n.createElement("div",{id:"middleSection",style:{display:e?"flex":"none"}},n.createElement("div",{id:"aboveScrolledArea"}),n.createElement("div",{id:"scrolledArea"}," ",n.createElement("div",{id:"aboveMessageArea"}),n.createElement("div",{id:"messageArea"},Object.values(a.focusedRoomRenderedMessages).map((e=>n.createElement(h,{message:e})))),n.createElement("div",{id:"belowMessageArea"})),n.createElement("div",{style:{height:5,background:"linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3))"}}),n.createElement("div",{id:"belowScrolledArea"},n.createElement("div",{contentEditable:!0,id:"messageBox"}),n.createElement("button",null,"upload"),n.createElement("button",null,"send")))}function p({server:e}){return[e.manifest,e.setManifest]=n.useState({icon:"",title:"Couldn't connect to this server 🐙"}),console.log(e),n.createElement("div",{className:"popoverContainer"},n.createElement("img",{className:"serverIcon",src:e.manifest.icon,alt:"🐙",onClick:()=>{a.setFocusedServer(e.serverCode),E(e.serverCode)}}),n.createElement("div",{className:"serverIconPopover"},e.manifest.title))}function S({room:e}){return n.createElement("div",{className:"roomLink",style:{cursor:"pointer"}},n.createElement("a",null,e.name))}function b({shown:e}){return n.createElement("div",{className:"sidebar",id:"roomsBar",style:{display:e?"flex":"none"}},n.createElement("div",{id:"serverTitle",style:{cursor:"pointer",backgroundImage:a.focusedServer?a.servers[a.focusedServer].manifest.icon:""}},n.createElement("h3",{style:{margin:5}},a.focusedServer?a.servers[a.focusedServer].manifest.title:"Loading servers..."),n.createElement("div",{style:{flexGrow:1}}),n.createElement("span",{className:"material-symbols-outlined"},"stat_minus_1")),Object.values(a.focusedServerRenderedRooms).map((e=>n.createElement(S,{server:e}))),0==Object.values(a.focusedServerRenderedRooms).length?n.createElement("p",null,"This server doesn't have any rooms in it."):n.createElement(n.Fragment,null))}d.protocol="https";const w=()=>n.createElement("title",null,"(Beta!) Platypuss");async function E(e){c&&(a.setFocusedRoomRenderedMessages({}),fetch(`${m}/getServerTokens?id=${localStorage.getItem("sessionID")}`).then((e=>e.json())).then((async function(t){for(let e of Object.values(l))e.close();for(let r in t.servers)i[r]=u(r),window.location.toString().replace(/^.*\#/g,"")!=i[r]||e||(console.log("focusing a server"),a.setFocusedServer(r));let s={};for(let r in t.servers){let n=r.split(" "),o=n[0],i=n[1],c=n[2];s[r]={ip:o,serverCode:r,inviteCode:i,subserver:c,manifest:{title:"Loading",icon:"/icon.png",memberCount:0,public:!1,description:"Waiting for a response from the server"}},fetch(d.protocol+"//"+o+"/"+c).then((e=>e.json())).then((e=>{s[r].setManifest(e)})).catch((e=>{console.log(e)}));let m=new WebSocket(("https:"==d.protocol?"wss:":"ws")+"//"+o);m.onerror=()=>{console.error(`Warning: couldn't connect to ${o}, try check your internet connection or inform the owner(s) of the server.`),a.focusedServer},m.onopen=()=>{l[r]=m,m.send(JSON.stringify({eventType:"login",subserver:c,inviteCode:i,sessionID:t.servers[r]})),a.servers[a.focusedServer]||(console.log(e,a.servers),a.servers[e]?a.setFocusedServer(e):(console.log("focusing a server"),a.setFocusedServer(r)))},m.onclose=()=>{console.error(`Warning, the server at ${o} closed.`),a.focusedServer},m.onmessage=async e=>{let t,s=JSON.parse(e.data);switch(s.eventType){case"message":if(a.focusedServer!==r)break;t={...a.focusedRoomRenderedMessages},t[s.message.id]=s.message,a.setFocusedRoomRenderedMessages(t);break;case"messages":if(a.focusedServer!==r)break;t={...a.focusedRoomRenderedMessages};for(let e of s.messages)t[e.id]=e;a.setFocusedRoomRenderedMessages(t)}}}a.setServers(s)})).catch((e=>console.log(e))))}function y(){return[a.servers,a.setServers]=n.useState({}),[a.focusedRoomRenderedMessages,a.setFocusedRoomRenderedMessages]=n.useState({}),[a.focusedServer,a.setFocusedServer]=n.useState(null),[a.focusedRoom,a.setFocusedRoom]=n.useState({}),[a.focusedServerRenderedRooms,a.setFocusedServerRenderedRooms]=n.useState({}),[a.mobileSidebarShown,a.setMobileSidebarShown]=n.useState(!0),[a.useMobileUI,a.setUseMobileUI]=n.useState(!!c&&2.54*window.innerWidth/96<20),c&&window.addEventListener("resize",(()=>{a.setUseMobileUI(!!c&&2.54*window.innerWidth/96<20)})),a.populated||E(),a.populated=!0,n.createElement(n.Fragment,null,n.createElement(r.m,{iconClickEvent:()=>{a.useMobileUI?a.setMobileSidebarShown(!a.mobileSidebarShown):window.location="/"}}),n.createElement("main",null,n.createElement("div",{id:"chatPage"},n.createElement(v,{shown:a.mobileSidebarShown||!a.useMobileUI}),n.createElement(b,{shown:a.mobileSidebarShown||!a.useMobileUI}),n.createElement(g,{shown:!a.mobileSidebarShown||!a.useMobileUI}),n.createElement(f,{shown:a.mobileSidebarShown||!a.useMobileUI}))))}}}]);
//# sourceMappingURL=component---src-pages-chat-js-ad5366559d7f905d936d.js.map